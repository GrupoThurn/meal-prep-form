<!DOCTYPE html>
<html lang="es-MX">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cotizacion Meal Prep</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: Arial, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
.container { max-width: 900px; margin: 0 auto; background: white; border-radius: 15px; padding: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
h1 { color: #667eea; text-align: center; margin-bottom: 30px; font-size: 2em; }
.form-section { margin-bottom: 25px; padding: 20px; background: #f8f9fa; border-radius: 10px; }
.form-section h2 { color: #764ba2; margin-bottom: 15px; font-size: 1.3em; }
.form-group { margin-bottom: 15px; }
label { display: block; margin-bottom: 5px; color: #333; font-weight: 600; }
input, select { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1em; }
input:focus, select:focus { outline: none; border-color: #667eea; }
.btn { padding: 12px 24px; border: none; border-radius: 8px; font-size: 1em; cursor: pointer; font-weight: 600; transition: all 0.3s; margin-right: 10px; }
.btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
.btn-primary:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4); }
.btn-success { background: #28a745; color: white; }
.btn-success:disabled { background: #6c757d; cursor: not-allowed; }
.btn-danger { background: #dc3545; color: white; }
.btn-secondary { background: #6c757d; color: white; }
.meal-card { background: white; padding: 15px; margin-bottom: 15px; border-radius: 8px; border: 2px solid #e0e0e0; }
.meal-card h3 { color: #667eea; margin-bottom: 10px; }
.ingrediente-row { display: grid; grid-template-columns: 1fr 1fr auto; gap: 10px; margin-bottom: 10px; align-items: end; }
#cotizacion { display: none; margin-top: 30px; padding: 25px; background: #e8f5e9; border-radius: 10px; border: 2px solid #28a745; }
.cotizacion-item { padding: 10px; margin: 5px 0; background: white; border-radius: 5px; }
.total { font-size: 1.5em; font-weight: bold; color: #28a745; text-align: center; margin-top: 15px; padding: 15px; background: white; border-radius: 8px; }
.alert { padding: 15px; border-radius: 8px; margin-bottom: 20px; }
.alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
.alert-error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
.spinner { display: none; border: 4px solid #f3f3f3; border-top: 4px solid #667eea; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 20px auto; }
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
.meals-container { display: none; }
</style>
</head>
<body>
<div class="container">
<h1>üçΩÔ∏è Cotizacion Meal Prep</h1>
<div id="alertContainer"></div>
<div id="spinner" class="spinner"></div>
<form id="mealPrepForm">
<div class="form-section">
<h2>üìã Informacion del Cliente</h2>
<div class="form-group"><label>Nombre Completo *</label><input type="text" id="nombre" required></div>
<div class="form-group"><label>Telefono *</label><input type="tel" id="telefono" required></div>
<div class="form-group"><label>Direccion de Entrega *</label><input type="text" id="direccion" required></div>
</div>
<div class="form-section">
<h2>üç± Plan de Comidas</h2>
<div class="form-group"><label>Comidas por Dia *</label><input type="number" id="comidasDia" min="1" max="6" value="3" required onchange="generarMeals()"></div>
<div class="form-group"><label>Dias por Semana *</label><input type="number" id="diasSemana" min="1" max="7" value="5" required></div>
</div>
<div class="form-section meals-container" id="mealsSection">
<h2>ü•ó Ingredientes por Comida</h2>
<div id="mealsContainer"></div>
</div>
<button type="button" class="btn btn-primary" onclick="calcularCotizacion()">üí∞ Calcular Cotizacion</button>
</form>
<div id="cotizacion">
<h2 style="color: #28a745; margin-bottom: 20px;">‚úÖ Cotizacion Generada</h2>
<div id="cotizacionDetalle"></div>
<div class="total" id="totalFinal"></div>
<button type="button" class="btn btn-success" id="btnEnviar" onclick="enviarCotizacion()">üì§ Enviar Pedido</button>
</div>
</div>
<script>
const GOOGLE_SCRIPT_URL = 'PASTE_YOUR_GOOGLE_APPS_SCRIPT_URL_HERE';

const ingredientesDB = {
    pollo: 0.12, arroz: 0.02, brocoli: 0.08, papa: 0.03,
    carne: 0.18, pescado: 0.22, huevo: 0.05, aguacate: 0.15,
    pasta: 0.025, frijoles: 0.04, zanahoria: 0.035, espinaca: 0.06
};

let cotizacionActual = null;

function mostrarAlerta(mensaje, tipo) {
    const container = document.getElementById('alertContainer');
    const alert = document.createElement('div');
    alert.className = 'alert alert-' + tipo;
    alert.textContent = mensaje;
    container.appendChild(alert);
    setTimeout(() => alert.remove(), 5000);
}

function generarMeals() {
    const numMeals = parseInt(document.getElementById('comidasDia').value);
    const container = document.getElementById('mealsContainer');
    const section = document.getElementById('mealsSection');
    
    container.innerHTML = '';
    
    for (let i = 1; i <= numMeals; i++) {
        const mealCard = document.createElement('div');
        mealCard.className = 'meal-card';
        mealCard.innerHTML = '<h3>Comida ' + i + '</h3><div id="meal' + i + 'Ingredients"></div>' +
            '<button type="button" class="btn btn-secondary" onclick="agregarIngrediente(' + i + ')">‚ûï Agregar Ingrediente</button>';
        container.appendChild(mealCard);
        agregarIngrediente(i);
    }
    
    section.style.display = 'block';
}

function agregarIngrediente(mealNum) {
    const container = document.getElementById('meal' + mealNum + 'Ingredients');
    const row = document.createElement('div');
    row.className = 'ingrediente-row';
    const opciones = Object.keys(ingredientesDB).map(ing => 
        '<option value="' + ing + '">' + ing.charAt(0).toUpperCase() + ing.slice(1) + '</option>'
    ).join('');
    row.innerHTML = '<div class="form-group"><label>Ingrediente</label><select class="ingrediente-select">' + opciones + '</select></div>' +
        '<div class="form-group"><label>Gramos</label><input type="number" class="ingrediente-gramos" min="1" value="100"></div>' +
        '<button type="button" class="btn btn-danger" onclick="this.parentElement.remove()">X</button>';
    container.appendChild(row);
}

function calcularCotizacion() {
    const nombre = document.getElementById('nombre').value.trim();
    const telefono = document.getElementById('telefono').value.trim();
    const direccion = document.getElementById('direccion').value.trim();
    const comidasDia = parseInt(document.getElementById('comidasDia').value);
    const diasSemana = parseInt(document.getElementById('diasSemana').value);
    
    if (!nombre || !telefono || !direccion) {
        mostrarAlerta('Completa todos los campos obligatorios', 'error');
        return;
    }
    
    const meals = [];
    let subtotal = 0;
    
    for (let i = 1; i <= comidasDia; i++) {
        const mealContainer = document.getElementById('meal' + i + 'Ingredients');
        if (!mealContainer) continue;
        
        const rows = mealContainer.querySelectorAll('.ingrediente-row');
        const mealIngredientes = [];
        
        rows.forEach(row => {
            const select = row.querySelector('.ingrediente-select');
            const gramos = parseInt(row.querySelector('.ingrediente-gramos').value);
            const ingrediente = select.value;
            const precio = ingredientesDB[ingrediente];
            const costo = precio * gramos * diasSemana;
            
            mealIngredientes.push({
                nombre: ingrediente,
                gramos: gramos,
                precio: precio,
                costo: costo
            });
            subtotal += costo;
        });
        
        meals.push({
            numero: i,
            ingredientes: mealIngredientes
        });
    }
    
    const margen = 30;
    const entrega = 300;
    const ganancia = subtotal * (margen / 100);
    const total = subtotal + ganancia + entrega;
    
    cotizacionActual = {
        nombre: nombre,
        telefono: telefono,
        direccion: direccion,
        comidasDia: comidasDia,
        diasSemana: diasSemana,
        meals: meals,
        subtotal: subtotal,
        margen: margen,
        ganancia: ganancia,
        entrega: entrega,
        total: total
    };
    
    mostrarCotizacion();
}

function mostrarCotizacion() {
    const detalle = document.getElementById('cotizacionDetalle');
    let html = '<div class="cotizacion-item"><strong>Cliente:</strong> ' + cotizacionActual.nombre + '</div>';
    html += '<div class="cotizacion-item"><strong>Telefono:</strong> ' + cotizacionActual.telefono + '</div>';
    html += '<div class="cotizacion-item"><strong>Direccion:</strong> ' + cotizacionActual.direccion + '</div>';
    html += '<div class="cotizacion-item"><strong>Plan:</strong> ' + cotizacionActual.comidasDia + ' comidas/dia x ' + cotizacionActual.diasSemana + ' dias/semana</div>';
    html += '<hr style="margin: 15px 0;">';
    
    cotizacionActual.meals.forEach(meal => {
        html += '<h3 style="color: #764ba2; margin: 10px 0;">Comida ' + meal.numero + ':</h3>';
        meal.ingredientes.forEach(ing => {
            html += '<div class="cotizacion-item">' + ing.nombre.charAt(0).toUpperCase() + ing.nombre.slice(1) + 
                ' (' + ing.gramos + 'g): $' + ing.costo.toFixed(2) + ' MXN</div>';
        });
    });
    
    html += '<hr style="margin: 15px 0;">';
    html += '<div class="cotizacion-item"><strong>Subtotal:</strong> $' + cotizacionActual.subtotal.toFixed(2) + ' MXN</div>';
    html += '<div class="cotizacion-item"><strong>Margen (' + cotizacionActual.margen + '%):</strong> $' + cotizacionActual.ganancia.toFixed(2) + ' MXN</div>';
    html += '<div class="cotizacion-item"><strong>Entrega Semanal:</strong> $' + cotizacionActual.entrega.toFixed(2) + ' MXN</div>';
    
    detalle.innerHTML = html;
    document.getElementById('totalFinal').textContent = 'TOTAL SEMANAL: $' + cotizacionActual.total.toFixed(2) + ' MXN';
    document.getElementById('cotizacion').style.display = 'block';
    document.getElementById('cotizacion').scrollIntoView({ behavior: 'smooth' });
}

function enviarCotizacion() {
    if (!cotizacionActual) {
        mostrarAlerta('Primero calcula la cotizacion', 'error');
        return;
    }
    
    const btnEnviar = document.getElementById('btnEnviar');
    const spinner = document.getElementById('spinner');
    
    btnEnviar.disabled = true;
    spinner.style.display = 'block';
    
    fetch(GOOGLE_SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(cotizacionActual)
    })
    .then(() => {
        spinner.style.display = 'none';
        mostrarAlerta('Pedido enviado exitosamente!', 'success');
        btnEnviar.disabled = false;
    })
    .catch(error => {
        spinner.style.display = 'none';
        mostrarAlerta('Error al enviar: ' + error.message, 'error');
        btnEnviar.disabled = false;
    });
}

window.onload = function() {
    generarMeals();
};
</script>
</body>
</html>